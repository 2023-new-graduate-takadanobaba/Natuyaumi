<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org">
<head>
<!-- <link href="@{/css/genre2-{id}.css(id=${id})}" rel="stylesheet"> -->
<!-- <link rel="stylesheet" href="css/genre2.css"> -->
<meta charset="UTF-8">

<title>詳細</title>
<style>
body {
	background-color: #d9eaea;
	color: #28495D;
}

.wrapper {
	max-width: 40%;
	margin: 0 auto;
	padding: 20px;
	background: rgba(255, 255, 255, 0.5);
	border-radius: 5px;
}

.modal {
	display: none;
	position: fixed;
	z-index: 1;
	left: 0;
	top: 0;
	width: 100%;
	height: 100%;
	overflow: auto;
	background-color: rgba(0, 0, 0, 0.4);
}

.modal-content {
	background-color: #fefefe;
	margin: 15% auto;
	padding: 20px;
	border: 1px solid #888;
	width: 300px;
	text-align: center;
}

img{
	width:90%;
	margin:10px;
	border-radius: 5px;
}

#mo{
display: none;
}

button {
	margin-top: 10px;
}
</style>
<body>
	<div class="wrapper">
		詳細

		<!-- <div th:each="article: ${articles}">-->
		<h1 th:text="${article.name}"></h1>
		<div>
			穴場度： <span th:switch="${article.level}"> <span th:case="1">★</span>
				<span th:case="2">★★</span> <span th:case="3">★★★</span> <span
				th:case="4">★★★★</span> <span th:case="5">★★★★★</span>
			</span>
		</div>
		<img th:src="${article.imageUrl}" />
		<h2 th:text="${article.title}"></h2>
		<h4 th:text="${article.review}"></h4>
		<p>
			所在地:<span th:text="${article.address}"></span>
		</p>
		<div th:switch="${article.hasParking}">
			<p th:case="true">駐車場あり</p>
			<p th:case="false">駐車場なし</p>
		</div>

		<p>
			行った月：<span th:text="${article.month}"></span>月
		</p>
		<!-- 		<a id="deleteButton" th:href="@{/delete/{id}(id=${article.id})}">削除</a> -->
		<!-- 		<div id="modal" class="modal"> -->
		<!-- 			<div class="modal-content"> -->
		<!-- 				<p>本当に削除しますか？</p> -->
		<!-- 				<button id="confirmButton">はい</button> -->
		<!-- 				<button id="cancelButton">やっぱりやめる</button> -->
		<!-- 			</div> -->
		

    <a href="" id="deleteButton">削除</a>
    <div id="modal" class="modal">
      <div class="modal-content">
        <p>本当に削除しますか？</p>
        <a th:href="@{/delete/{id}(id=${article.id})}"><button id="confirmButton">はい</button></a>
        <button id="cancelButton">やっぱりやめる</button>
      </div>
    </div>

    <p id="mo">削除されました。</p>
    <a id="modoru" th:href="@{/returnTop}">戻る</a>
  </div>

  <script>
    // ボタンとモーダル要素の参照を取得
    const deleteButton = document.getElementById('deleteButton');
    const modal = document.getElementById('modal');
    const confirmButton = document.getElementById('confirmButton');
    const cancelButton = document.getElementById('cancelButton');
    const mo = document.getElementById('mo'); // mo要素の参照を追加

    // 削除ボタンがクリックされたときの処理
    deleteButton.addEventListener('click', function() {
    	 event.preventDefault(); 
      // モーダルを表示する
      modal.style.display = 'block';
    });

    //URLからパスパラメータを抽出するための正規表現パターン
    var pattern = /\/delete\/(\d+)/;
    //現在のURLを取得
    var currentUrl = window.location.href;

    // 正規表現パターンを使用してパスパラメータを抽出
    var matches = currentUrl.match(pattern);

    // マッチ結果が存在するかを確認
    if (matches && matches.length > 1) {
      // パスパラメータの値を取得
      var articleIdFromURL = matches[1];

      // はいボタンがクリックされたときの処理
      confirmButton.addEventListener('click', function(event) {
        event.preventDefault(); // デフォルトのイベントをキャンセルする

        // Ajaxリクエストを送信する
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/delete/' + articleIdFromURL, true);
        xhr.onreadystatechange = function(event) {
          if (xhr.readyState === 4) {
            if (xhr.status === 200) {
              // 削除が成功した場合の処理
              window.location.href = '/natuyasumi/top';
            } else {
              // 削除が失敗した場合の処理
              console.error('削除エラー');
            }
          }
        };
        xhr.send();

        // モーダルを閉じる
        modal.style.display = 'none';
        // 削除されましたと表示
        mo.style.display = 'block';
      });

      // やっぱりやめるボタンがクリックされたときにも戻る処理をキャンセルする場合
      cancelButton.addEventListener('click', function() {
        // モーダルを閉じる
        modal.style.display = 'none';
        // 削除処理をキャンセルする
        console.log('削除がキャンセルされました');
      });
    }
  </script>
</body>
</html>


