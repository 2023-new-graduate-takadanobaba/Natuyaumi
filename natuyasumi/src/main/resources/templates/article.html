<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org">
<head>
<link th:href="@{/css/genre2.css}" rel="stylesheet">
<!-- <link rel="stylesheet" href="css/genre2.css"> -->
<meta charset="UTF-8">

<title>詳細</title>
</head>

<body>
	<div class="wrapper" >
	<div id="dehine">

		<!-- <div th:each="article: ${articles}">-->
		<h1 th:text="${article.name}"></h1>
		<div>
			穴場度： <span th:switch="${article.level}"> <span th:case="1">★</span>
				<span th:case="2">★★</span> <span th:case="3">★★★</span> <span
				th:case="4">★★★★</span> <span th:case="5">★★★★★</span>
			</span>
		</div>
		<img th:src="${article.imageUrl}" />
		<h2 th:text="${article.title}"></h2>
		<h4 th:text="${article.review}"></h4>
		<p>
			所在地:<span th:text="${article.address}"></span>
		</p>
		<div th:switch="${article.hasParking}">
			<p th:case="true">駐車場あり</p>
			<p th:case="false">駐車場なし</p>
		</div>

		<p>
			行った月：<span th:text="${article.month}"></span>月
		</p>
		<!-- 		<a id="deleteButton" th:href="@{/delete/{id}(id=${article.id})}">削除</a> -->
		<!-- 		<div id="modal" class="modal"> -->
		<!-- 			<div class="modal-content"> -->
		<!-- 				<p>本当に削除しますか？</p> -->
		<!-- 				<button id="confirmButton">はい</button> -->
		<!-- 				<button id="cancelButton">やっぱりやめる</button> -->
		<!-- 			</div> -->
		

    <a href="" id="deleteButton">削除</a>
    <div id="modal" class="modal">
      <div class="modal-content">
        <p>本当に削除しますか？</p>
        <a th:href="@{/delete/{id}(id=${article.id})}"><button id="confirmButton">はい</button></a>
        <button id="cancelButton">やっぱりやめる</button>
      </div>
    </div>
    </div>

    <p id="mo">削除されました。</p>
    <input value="戻る" onclick="history.back();" type="button" id="modoru">
    <a  th:href="@{/returnTop}" id="modoru2">戻る</a>
  </div>

  <script>
    // ボタンとモーダル要素の参照を取得
    const deleteButton = document.getElementById('deleteButton');
    const modal = document.getElementById('modal');
    const confirmButton = document.getElementById('confirmButton');
    const cancelButton = document.getElementById('cancelButton');
    const mo = document.getElementById('mo'); // mo要素の参照を追加
    const dehine = document.getElementById('dehine');
    const modoru = document.getElementById('modoru');
    const modoru2 = document.getElementById('modoru2');
    

    // 削除ボタンがクリックされたときの処理
    deleteButton.addEventListener('click', function() {
    	event.preventDefault(); 
      // モーダルを表示する
      modal.style.display = 'block';
    });

    //URLからパスパラメータを抽出するための正規表現パターン
    var pattern = /\/doDisplayAirticle\/(\d+)/;
    //現在のURLを取得
    var currentUrl = window.location.href;

    // 正規表現パターンを使用してパスパラメータを抽出,結果はmatchesという配列に格納
    var matches = currentUrl.match(pattern);

    // マッチ結果が存在するかを確認
    if (matches && matches.length > 1) {
      // パスパラメータの値を取得
      var articleIdFromURL = matches[1];

      // はいボタンがクリックされたときの処理
      confirmButton.addEventListener('click', function(event) {
        event.preventDefault(); // デフォルトのイベントをキャンセルする

        // Ajaxリクエストを送信する
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/natuyasumi/delete/' + articleIdFromURL, true);
        xhr.onreadystatechange = function(event) {
          if (xhr.readyState === 4) {
            if (xhr.status === 200) {
              // 削除が成功した場合の処理
              // 削除されましたと表示
              dehine.style.display = 'none';
              modoru.style.display = 'none';
        	  mo.style.display = 'block';
        	  modoru2.style.display = 'block';

              //window.location.href = '/natuyasumi/top'; 
            } else {
              // 削除が失敗した場合の処理
              console.error('削除エラー');
            }
          }
        };
        xhr.send();

        // モーダルを閉じる
        modal.style.display = 'none';
        
      });

   // やっぱりやめるボタンがクリックされたときの処理
      cancelButton.addEventListener('click', function() {
        // モーダルを閉じる
        modal.style.display = 'none';
       
      });
    }
   
  
  </script>
</body>
</html>


